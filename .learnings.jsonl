{"timestamp":"2026-01-02T18:56:41Z","severity":"Major","issue":"Inconsistent behavior with config reset on load - Fish implementation resets config variables to defaults at start of _itint_load_config, but bash version uses ${VAR:=default} which preserves environment-set values","fix":"Use set -q VAR; or set -g VAR value pattern for ITINT_DEFAULT_SATURATION, ITINT_DEFAULT_LIGHTNESS, and ITINT_HASH_MODE"}
{"timestamp":"2026-01-02T18:56:44Z","severity":"Major","issue":"Missing hue validation in _itint_update - hue validation only checks if numeric but doesn't validate range 0-360, allowing invalid values like 999","fix":"Add range validation: if test -z $hue; or not string match -qr '^[0-9]+$' -- $hue; or test $hue -gt 360; return 1; end"}
{"timestamp":"2026-01-02T18:56:47Z","severity":"Minor","issue":"Potential issue with empty $PWD in _itint_update - if $PWD is empty or unset, _itint_find_override $PWD would behave unexpectedly","fix":"Add guard: test -z $PWD; and return"}
{"timestamp":"2026-01-02T18:56:50Z","severity":"Minor","issue":"Different comment handling in section headers - Fish version matches [*] for any section header, while bash uses [*]* which allows trailing content. Fish won't match [section] # comment","fix":"Align behavior by using: case '[*]' '[*] *'"}
{"timestamp":"2026-01-02T00:00:00Z","severity":"Major","issue":"local keyword not POSIX-compliant - install.sh uses #!/bin/sh shebang but declares local variables in get_source_line() and setup_shell()","fix":"Change shebang to #!/bin/bash or use naming convention like _var for local-scope variables"}
{"timestamp":"2026-01-02T00:00:00Z","severity":"Major","issue":"Fish directory may not exist - ~/.config/fish/ directory is not created before touch","fix":"Add mkdir -p \"$(dirname \"$rc_file\")\" before touch in setup_shell()"}
{"timestamp":"2026-01-02T00:00:00Z","severity":"Minor","issue":"git pull without specifying branch - relies on tracking configuration and could pull wrong branch","fix":"Use git pull --quiet origin main to be explicit about which branch to pull"}
{"timestamp":"2026-01-02T00:00:00Z","severity":"Minor","issue":"No error handling for directory change - cd could fail silently due to set -e","fix":"Add explicit error handling: cd \"$INSTALL_DIR\" || { error \"Failed to enter $INSTALL_DIR\"; exit 1; }"}
{"timestamp":"2026-01-02T20:04:51Z","severity":"Major","issue":"Undefined variable $rc_file in final output when shell detection fails","fix":"Need to move final instructions inside shell-specific block or handle unknown case"}
{"timestamp":"2026-01-02T20:04:56Z","severity":"Minor","issue":"Missing error handling after cd command - directory may exist but be unreadable","fix":"Add error check: cd \"$INSTALL_DIR\" || error \"Cannot enter directory\""}
{"timestamp":"2026-01-02T20:05:01Z","severity":"Minor","issue":"git pull fallback may hide real errors like network or auth issues","fix":"Be more explicit about fallback handling or provide warning when fallback is used"}
{"timestamp":"2026-01-02T20:05:06Z","severity":"Minor","issue":"local keyword is not strictly POSIX-compliant, may not work in all sh implementations","fix":"Documented as accepted practice in CLAUDE.md for target platforms (macOS, Linux with bash/dash/zsh)"}
{"timestamp":"2026-01-02T14:10:00Z","severity":"critical","issue":"git pull success message shown even when update fails (install.sh:98-99)","fix":"Make success message conditional: if git pull --quiet origin main 2>/dev/null || git pull --quiet 2>/dev/null; then success \"Updated iterm-tint\"; else warn \"Could not update repository\"; fi"}
{"timestamp":"2026-01-02T14:10:01Z","severity":"major","issue":"git clone failure produces no error message (install.sh:102)","fix":"Add explicit error handling: if ! git clone --quiet \"$REPO_URL\" \"$INSTALL_DIR\"; then error \"Failed to clone iterm-tint repository\"; fi"}
{"timestamp":"2026-01-02T14:10:02Z","severity":"minor","issue":"Magic string grep check may cause false positives (install.sh:163)","fix":"Use more specific grep pattern: grep -qF \".iterm-tint/\" \"$rc_file\" 2>/dev/null"}
{"timestamp":"2026-01-02T14:31:00Z","severity":"major","issue":"set -e combined with sourcing can cause silent test failures","fix":"Set _ITINT_INITIALIZED=1 before sourcing iterm-tint.sh to skip initialization side effects during tests"}
{"timestamp":"2026-01-02T14:31:01Z","severity":"minor","issue":"Test for different paths producing different hues is unreliable due to hash collisions","fix":"Replace with deterministic fixtures that assert exact known outputs or only validate range and stability"}
{"timestamp":"2026-01-02T14:31:02Z","severity":"minor","issue":"Test suite only runs under bash, violating project conventions for dual bash/zsh testing","fix":"Add wrapper script or documentation to run tests in both shells (bash ./tests/test.sh && zsh ./tests/test.sh)"}
{"timestamp":"2026-01-02T14:31:03Z","severity":"nit","issue":"Inconsistent test patterns using manual counter increments instead of assertion helpers","fix":"Add assert_in_range() or assert_true() helper functions to reduce duplication"}
{"timestamp":"2026-01-02T14:31:04Z","severity":"nit","issue":"Hue range comment says 0-359 but test uses hue -lt 360 (inconsistent wording)","fix":"Use hue -le 359 to match the comment more clearly"}
{"timestamp":"2026-01-02T14:31:05Z","severity":"nit","issue":"Printf color variables could use more robust escape sequence handling","fix":"Use printf '%b' with escape sequences instead of printf with variable interpolation"}
{"timestamp":"2026-01-02T14:31:06Z","severity":"nit","issue":"Missing cleanup documentation noting global state is set by sourcing","fix":"Add comment noting tests assume single-run execution"}
